# 롤 정의 검증 가이드

## 문제점

현재 검증 결과에서 발견된 문제:
- "딥라잉 플레이메이커" 적합도가 거의 모든 선수에서 0.996~1.000으로 매우 높게 나옴 (구분력 부족)
- 상위 적합도 선수들이 실제 롤과 맞지 않는 포지션 (LB, CB, CF 등)

이는 **롤 템플릿 정의나 지표 정규화/가중치에 문제**가 있음을 시사합니다.

## 검증 방법

### 1. 테스트 케이스 기반 검증 (가장 중요)

**목적**: 실제로 알려진 롤을 가진 선수들이 우리 모델에서 올바르게 식별되는지 확인

**방법**:
1. **축구 전문가/팬 커뮤니티에서 "딥라잉 플레이메이커"로 알려진 선수들 찾기**
   - 예: K리그에서 유명한 딥라잉 플레이메이커 선수들의 이름
   - 데이터에서 해당 선수의 `player_id` 찾기
   
2. **테스트 케이스 구성**:
   ```python
   test_cases = {
       356618: '딥라잉 플레이메이커',  # 실제 선수 ID
       500115: '딥라잉 플레이메이커',
       # ...
   }
   ```

3. **검증 기준**:
   - 테스트 케이스 선수들이 **상위 N% (예: 상위 20%)** 안에 들어가는가?
   - 테스트 케이스 선수들의 적합도가 **전체 평균보다 유의미하게 높은가?**

### 2. 포지션별 필터링 검증

**목적**: 롤이 특정 포지션과 연관되어 있는지 확인

**방법**:
- "딥라잉 플레이메이커"는 보통 **CDM, CM** 포지션에서 나옴
- 상위 적합도 선수들 중 **CDM/CM 비율**이 높아야 함
- 만약 LB, CB, CF가 많이 나온다면 → 롤 정의 수정 필요

### 3. 지표별 기여도 분석

**목적**: 어떤 지표가 롤 구분에 가장 중요한지 파악

**방법**:
- 각 지표를 하나씩 제거하고 적합도 재계산
- 적합도 변화가 큰 지표 = 중요한 지표
- 적합도 변화가 작은 지표 = 제거하거나 가중치 낮춤

### 4. 롤 간 구분력 확인

**목적**: 서로 다른 롤들이 명확히 구분되는지 확인

**방법**:
- "딥라잉 플레이메이커"와 "인벌빙 풀백"의 적합도 분포가 겹치지 않는가?
- 같은 선수가 여러 롤에서 모두 높은 적합도를 가지는가? (문제 신호)

## 실제 검증 절차

### Step 1: 테스트 케이스 수집

**필요한 작업**:
1. K리그 팬 커뮤니티/전문가에게 질문:
   - "K리그에서 딥라잉 플레이메이커로 유명한 선수는 누구인가요?"
   - "인벌빙 풀백으로 알려진 선수는 누구인가요?"

2. 데이터에서 선수 이름으로 `player_id` 찾기:
   ```python
   # 예시
   df[df['player_name_ko'].str.contains('선수이름', na=False)]['player_id'].unique()
   ```

3. `validation/validate_roles.py`의 `test_cases` 딕셔너리에 추가

### Step 2: 검증 실행 및 결과 분석

```bash
python validation/validate_roles.py
```

**확인 사항**:
- 테스트 케이스 선수들이 상위 적합도에 포함되는가?
- 상위 적합도 선수들의 포지션이 롤과 일치하는가?
- 적합도 분포가 넓게 퍼져 있는가? (구분력 확인)

### Step 3: 롤 템플릿 조정

**문제 발견 시 조정 방법**:

1. **지표 가중치 조정**:
   - 현재는 모든 지표를 동일 가중치로 계산
   - 중요한 지표에 높은 가중치 부여 필요
   - 예: "딥라잉 플레이메이커"는 `touch_zone_forward`(후방)와 `long_pass_ratio`에 높은 가중치

2. **롤 템플릿 값 조정**:
   - 실제 테스트 케이스 선수들의 평균 프로파일을 계산
   - 그 값을 롤 템플릿으로 사용

3. **지표 추가/제거**:
   - 구분력이 없는 지표 제거
   - 새로운 구분 지표 추가 (예: 패스 각도, 압박 강도 등)

### Step 4: 반복 검증

롤 템플릿을 조정한 후 다시 검증 실행하여 개선 여부 확인

## 검증 결과 해석 기준

### ✅ 좋은 검증 결과:
- 테스트 케이스 선수들이 상위 20% 안에 포함
- 상위 적합도 선수들의 포지션이 롤과 일치
- 적합도 분포가 넓게 퍼져 있음 (표준편차 > 0.05)
- 서로 다른 롤 간 구분이 명확함

### ❌ 나쁜 검증 결과:
- 테스트 케이스 선수들이 중위권 이하
- 상위 적합도 선수들의 포지션이 롤과 불일치
- 적합도가 모두 비슷함 (표준편차 < 0.01)
- 서로 다른 롤 간 구분이 모호함

## 주의사항

1. **도메인 전문가 검토 필수**: 
   - 이 검증은 기술적 검증일 뿐, 실제 축구 지식과 비교하여 검토 필요
   - 롤 정의 자체가 축구 도메인에서 맞는지 확인 필요

2. **데이터 한계**:
   - 현재 데이터는 2024 시즌 일부 경기만 포함
   - 선수의 롤은 시즌/경기마다 달라질 수 있음
   - 충분한 샘플 수 확보 필요

3. **롤 정의의 주관성**:
   - "딥라잉 플레이메이커"의 정의가 사람마다 다를 수 있음
   - 여러 전문가의 의견을 종합하여 검증 기준 설정 권장

